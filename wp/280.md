<!--
author: qingliangcn
date: 2010-08-03
title: Erlang OTP之terminate 深入分析
tags: Erlang,one_for_one,otp,simple_one_for_one,supervisor,terminate
category: Erlang
status: publish
summary: 作者：庆亮 (qing.liang.cn@gmail.com)日期：2010-08-03环境：centos&nbsp; 5.5&nbsp; 64 &nbsp;&nbsp;&nbsp;&nbsp;erlang 14A &nbsp;一、terminate简述及问题产生&nbsp;te
-->

<h1 style="margin: 17pt 0cm 16.5pt"><span style="font-size: 12px"><b><font color="#000000"><span style="font-family: 宋体">作者：庆亮</span><span lang="EN-US"><font face="Calibri"> (<a href="mailto:qing.liang.cn@gmail.com">qing.liang.cn@gmail.com</a>)</font></span></font></b></span></h1>
<h1 style="margin: 17pt 0cm 16.5pt"><span style="font-size: 12px"><b><font color="#000000"><span style="font-family: 宋体">日期：</span><span lang="EN-US"><font face="Calibri">2010-08-03</font></span></font></b></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><b><font color="#000000"><span style="font-family: 宋体">环境：</span><span lang="EN-US"><font face="Calibri">centos&nbsp; 5.5&nbsp; 64 &nbsp;&nbsp;&nbsp;&nbsp;erlang 14A </font></span></font></b></span><b><font color="#000000"><font size="3"><span lang="EN-US"><font face="Calibri"><o:p></o:p></font></span></font></font></b></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000" face="Calibri">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -22.5pt; margin: 0cm 0cm 0pt 22.5pt"><span style="font-size: 12px"><font color="#000000"><font face="Calibri"><b><span lang="EN-US">一、</span></b><b><span lang="EN-US">terminate</span></b></font><b><span style="font-family: 宋体">简述及问题产生</span></b></font></span><font color="#000000"><font size="3"><b><span lang="EN-US"><o:p></o:p></span></b></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><b><span lang="EN-US"><o:p><font color="#000000" face="Calibri">&nbsp;</font></o:p></span></b></span><b><span lang="EN-US"><o:p></o:p></span></b></p>
<p align="left" class="MsoNormal" style="text-align: left; text-indent: 21pt; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US"><font face="Calibri">terminate</font></span><span style="font-family: 宋体">是</span><span lang="EN-US"><font face="Calibri">gen_server</font></span><span style="font-family: 宋体">的一个回调函数，如果一个</span><span lang="EN-US"><font face="Calibri">gen_server</font></span><span style="font-family: 宋体">进程设置了</span><span lang="EN-US"><font face="Calibri">trap_exit</font></span><span style="font-family: 宋体">为</span><span lang="EN-US"><font face="Calibri">true</font></span><span style="font-family: 宋体">（</span><span lang="EN-US"><font face="Calibri">process_flag(trap_exit, true)</font></span><span style="font-family: 宋体">），则在该进程结束时会自动调用</span><span lang="EN-US"><font face="Calibri">terminate</font></span><span style="font-family: 宋体">。利用这个功能，我们可以在进程退出时进行一些善后工作，例如持久化数据、清理等等。但实际上</span><span lang="EN-US"><font face="Calibri">terminate</font></span><span style="font-family: 宋体">不一定有时间完成所有的任务，在此之前可能已经被系统强制结束了</span><span lang="EN-US"><font face="Calibri">(</font></span><span style="font-family: 宋体">如果使用</span><span lang="EN-US"><font face="Calibri">init:stop</font></span><span style="font-family: 宋体">形式结束</span><span lang="EN-US"><font face="Calibri">beam)</font></span><span style="font-family: 宋体">。<!--more--></span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000" face="Calibri">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -22.5pt; margin: 0cm 0cm 0pt 22.5pt"><span style="font-size: 12px"><font color="#000000"><b><span lang="EN-US"><font face="Calibri">二、</font></span><span style="font-family: 宋体">测试</span><span lang="EN-US"><font face="Calibri">terminate</font></span></b></font></span><font color="#000000"><font size="3"><b><span lang="EN-US"><font face="Calibri"><o:p></o:p></font></span></b></font></font></p>
<p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span style="font-family: 宋体">一个</span><span lang="EN-US"><font face="Calibri">erlang </font></span><span style="font-family: 宋体">内部</span><span lang="EN-US"><font face="Calibri"> process</font></span><span style="font-family: 宋体">结束有两种形式：主动结束（如玩家下线后，玩家进程会自动结束）和被动结束</span><span lang="EN-US"><font face="Calibri">(init:stop)</font></span><span style="font-family: 宋体">。</span><font face="Calibri"> </font></font></span></p>
<p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span style="font-family: 宋体">系统停止时（</span><span lang="EN-US"><font face="Calibri">init:stop/c:q/erlang:halt</font></span><span style="font-family: 宋体">），会依次停止所有的进程，如果一个进程是监控树，则该监控树会先依次停止所有的子进程，然后结束自己。对于子进程也是同样的处理方法。</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000" face="Calibri">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体"><font color="#000000">先做测试，后分析源码。测试分为四种情况：</font></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000" face="Calibri">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><strong><span style="font-family: 宋体">进程主动退出</span><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""> + simple_one_for_one</font></span></strong></font></span><font color="#000000"><font size="3"><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><o:p></o:p></font></span></strong></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><font color="#000000">init:stop + simple_one_for_one</font></font></span></strong></span><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><font color="#000000"><font size="3"><o:p></o:p></font></font></font></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><strong><span style="font-family: 宋体">进程主动退出</span><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""> + one_for_one</font></span></strong></font></span><font color="#000000"><font size="3"><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><o:p></o:p></font></span></strong></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><font color="#000000">init:stop + one_for_one</font></font></span></strong></span><strong><span lang="EN-US" style="font-family: 'calibri', 'sans-serif'"><font face=""><font color="#000000"><font size="3"><o:p></o:p></font></font></font></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体"><font color="#000000">源码文件：</font></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><font color="#000000">test.erl (application)</font></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><font color="#000000">test_sup.erl (supervisor)</font></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><font color="#000000">test_server.erl (gen_server)</font></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">test.erl</span><span style="font-family: 宋体">源码：</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">module</span></b><span lang="EN-US" style="font-family: consolas; color: black">(test).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">behaviour</span></b><span lang="EN-US" style="font-family: consolas; color: black">(application).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">export</span></b><span lang="EN-US" style="font-family: consolas; color: black">([start</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/0</span><span lang="EN-US" style="font-family: consolas; color: black">, start</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/2</span><span lang="EN-US" style="font-family: consolas; color: black">, stop</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/1</span><span lang="EN-US" style="font-family: consolas; color: black">]).<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">start</span><span lang="EN-US" style="font-family: consolas; color: black">() </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">application</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start(test).<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">start</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">StartType</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">StartArgs</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><b><span lang="EN-US" style="font-family: consolas; color: blue">test_sup</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start_link() </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Error</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Error</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">.<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">stop</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; ok.</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">非常简单，直接通过</span><span style="font-family: consolas; color: black"> <span lang="EN-US">erl -name test@192.168.1.83 -setcookie 123456 -boot start_sasl -s test start </span></span><span style="font-family: 宋体; color: black">即可启动该</span><span lang="EN-US" style="font-family: consolas; color: black">app</span><span style="font-family: 宋体; color: black">。</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">test_sup.erl</span><span style="font-family: 宋体; color: black">源码：</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">module</span></b><span lang="EN-US" style="font-family: consolas; color: black">(test_sup).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">behaviour</span></b><span lang="EN-US" style="font-family: consolas; color: black">(supervisor).<br />
		<br />
		</span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% API</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">export</span></b><span lang="EN-US" style="font-family: consolas; color: black">([start_link</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/0</span><span lang="EN-US" style="font-family: consolas; color: black">]).<br />
		<br />
		</span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Supervisor callbacks</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">export</span></b><span lang="EN-US" style="font-family: consolas; color: black">([init</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/1</span><span lang="EN-US" style="font-family: consolas; color: black">]).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">define</span></b><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">SERVER</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?MODULE</span><span lang="EN-US" style="font-family: consolas; color: black">).<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">start_link</span><span lang="EN-US" style="font-family: consolas; color: black">() </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">supervisor</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start_link({local, </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?SERVER</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?MODULE</span><span lang="EN-US" style="font-family: consolas; color: black">, []).<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">init</span><span lang="EN-US" style="font-family: consolas; color: black">([]) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">RestartStrategy</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> simple_one_for_one,<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxRestarts</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">1000</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxSecondsBetweenRestarts</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">3600</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupFlags</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">RestartStrategy</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxRestarts</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxSecondsBetweenRestarts</span><span lang="EN-US" style="font-family: consolas; color: black">},<br />
		<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Restart</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> transient,<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Shutdown</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">200000</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Type</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> worker,<br />
		<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">AChild</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> {test_server, {test_server, start_link, []},<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Restart</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Shutdown</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Type</span><span lang="EN-US" style="font-family: consolas; color: black">, [test_server]},<br />
		<br />
		&nbsp;&nbsp;&nbsp; {ok, {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupFlags</span><span lang="EN-US" style="font-family: consolas; color: black">, [</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">AChild</span><span lang="EN-US" style="font-family: consolas; color: black">]}}.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">源码骨架都是</span><span lang="EN-US" style="font-family: consolas; color: black">emacs</span><span style="font-family: 宋体; color: black">生成的，我们只关注</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">RestartStrategy</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> simple_one_for_one,</span><span style="font-family: 宋体; color: black">这里，等会需要改成</span><span lang="EN-US" style="font-family: consolas; color: black">one_for_one</span><span style="font-family: 宋体; color: black">以便测试对比。</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">test_server.erl</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">module</span></b><span lang="EN-US" style="font-family: consolas; color: black">(test_server).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">behaviour</span></b><span lang="EN-US" style="font-family: consolas; color: black">(gen_server).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">export</span></b><span lang="EN-US" style="font-family: consolas; color: black">([<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/0</span><span lang="EN-US" style="font-family: consolas; color: black">, <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start_link</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/0</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">export</span></b><span lang="EN-US" style="font-family: consolas; color: black">([init</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/1</span><span lang="EN-US" style="font-family: consolas; color: black">, handle_call</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/3</span><span lang="EN-US" style="font-family: consolas; color: black">, handle_cast</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/2</span><span lang="EN-US" style="font-family: consolas; color: black">, handle_info</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/2</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; terminate</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/2</span><span lang="EN-US" style="font-family: consolas; color: black">, code_change</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">/3</span><span lang="EN-US" style="font-family: consolas; color: black">]).<br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">define</span></b><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">SERVER</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?MODULE</span><span lang="EN-US" style="font-family: consolas; color: black">). <br />
		<br />
		-</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(153,153,153)">record</span></b><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">state</span><span lang="EN-US" style="font-family: consolas; color: black">, {}).<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">start</span><span lang="EN-US" style="font-family: consolas; color: black">() </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {ok, _} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><b><span lang="EN-US" style="font-family: consolas; color: blue">supervisor</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start_child(test_sup, []).<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">start_link</span><span lang="EN-US" style="font-family: consolas; color: black">() </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">gen_server</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start_link(</span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?MODULE</span><span lang="EN-US" style="font-family: consolas; color: black">, [], []).<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">init</span><span lang="EN-US" style="font-family: consolas; color: black">([]) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">erlang</span></b><span lang="EN-US" style="font-family: consolas; color: black">:</span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">process_flag</span><span lang="EN-US" style="font-family: consolas; color: black">(trap_exit, true),<br />
		&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state</span><span lang="EN-US" style="font-family: consolas; color: black">{}}.<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_call</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Request</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">From</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reply</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> ok,<br />
		&nbsp;&nbsp;&nbsp; {reply, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reply</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}.<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_cast</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Msg</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {noreply, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}.<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_info</span><span lang="EN-US" style="font-family: consolas; color: black">({&#39;EXIT&#39;, _, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">io</span></b><span lang="EN-US" style="font-family: consolas; color: black">:format(</span><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;exit:</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(187,102,136)">~p~n</span></b><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;</span><span lang="EN-US" style="font-family: consolas; color: black">, [</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">]),<br />
		&nbsp;&nbsp;&nbsp; {stop, normal, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_info</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Info</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {noreply, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}.<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">terminate</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">io</span></b><span lang="EN-US" style="font-family: consolas; color: black">:format(</span><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;i&#39;m terminate:</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(187,102,136)">~p~n</span></b><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;</span><span lang="EN-US" style="font-family: consolas; color: black">, [</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">]),<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">timer</span></b><span lang="EN-US" style="font-family: consolas; color: black">:sleep(</span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">10000</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">io</span></b><span lang="EN-US" style="font-family: consolas; color: black">:format(</span><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;</span><b><span lang="EN-US" style="font-family: consolas; color: rgb(187,102,136)">~s</span></b><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;</span><span lang="EN-US" style="font-family: consolas; color: black">, [</span><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;end&quot;</span><span lang="EN-US" style="font-family: consolas; color: black">]),<br />
		&nbsp;&nbsp;&nbsp; ok.<br />
		<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">code_change</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OldVsn</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Extra</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">简单说明下</span><span lang="EN-US" style="font-family: consolas; color: black">test_server</span><span style="font-family: 宋体; color: black">：</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoListParagraph" style="text-align: left; text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoListParagraph" style="text-align: left; text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><span lang="EN-US" style="font-family: consolas; color: black"><span><font size="3">2．</font><span style="font: 7pt 'times new roman'"> </span></span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_info</span><span lang="EN-US" style="font-family: consolas; color: black">({&#39;EXIT&#39;, _, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span style="font-family: 宋体; color: black">方便</span><span lang="EN-US" style="font-family: consolas; color: black">simple_one_for_one</span><span style="font-family: 宋体; color: black">下进程进程退出操作</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoListParagraph" style="text-align: left; text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><font color="#000000"><span lang="EN-US" style="font-family: consolas"><span><font size="3">3．</font><span style="font: 7pt 'times new roman'"> </span></span></span><font size="3"><span lang="EN-US" style="font-family: consolas">terminate</span><span style="font-family: 宋体">中的清理工作：</span><span lang="EN-US" style="font-family: consolas">io </span><span style="font-family: 宋体">&rarr;</span><span lang="EN-US" style="font-family: consolas"> timer:sleep </span><span style="font-family: 宋体">&rarr;</span><span lang="EN-US" style="font-family: consolas"> io<o:p></o:p></span></font></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font color="#000000"><font size="3"><span style="font-family: 宋体">启动命令行：</span><span lang="EN-US" style="font-family: consolas; color: black">erl -name test@192.168.1.83 -setcookie 123456 -boot start_sasl -s test start<o:p></o:p></span></font></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoListParagraph" style="text-align: left; text-indent: -21pt; margin: 0cm 0cm 0pt 21pt"><font color="#000000"><b><span lang="EN-US" style="font-family: consolas"><span><font size="3">1．</font><span style="font: 7pt 'times new roman'"> </span></span></span></b><font size="3"><b><span style="font-family: 宋体">进程主动退出</span></b><b><span lang="EN-US" style="font-family: consolas"> + simple_one_for_one<o:p></o:p></span></b></font></font></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">(test@192.168.1.83)1&gt; erlang:exit(list_to_pid(&quot;&lt;0.51.0&gt;&quot;), test).</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">exit:test</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">true</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">i&#39;m terminate:normal</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">(test@192.168.1.83)2&gt; end</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font color="#000000"><font size="3"><span style="font-family: 宋体">正常完成了</span><span lang="EN-US" style="font-family: consolas">terminate<o:p></o:p></span></font></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><b><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></b></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font color="#000000"><font size="3"><b><span lang="EN-US" style="font-family: consolas">2</span></b><b><span style="font-family: 宋体">．</span></b><b><span lang="EN-US" style="font-family: consolas"> init:stop + simple_one_for_one<o:p></o:p></span></b></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<blockquote>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><span>&nbsp;</span><span style="font-size: 12px">(test@192.168.1.83)1&gt; test_server:start().</span><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">{ok,&lt;0.53.0&gt;}</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">(test@192.168.1.83)2&gt; init:stop().</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">ok</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">(test@192.168.1.83)3&gt; i&#39;m terminate:shutdown</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">[root@ming2_local_dev test]#</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
</blockquote>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">可以看到似乎没能正常的处理完</span><span lang="EN-US" style="font-family: consolas; color: black">terminate<o:p></o:p></span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><b><span lang="EN-US" style="font-family: consolas; color: black">3. </span></b><b><span style="font-family: 宋体; color: black">进程主动退出</span></b><b><span lang="EN-US" style="font-family: consolas; color: black"> + one_for_one<o:p></o:p></span></b></font></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">(test@192.168.1.83)1&gt; erlang:exit(list_to_pid(&quot;&lt;0.51.0&gt;&quot;), test).</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">exit:test</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">true</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">i&#39;m terminate:normal</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas"><font color="#000000">(test@192.168.1.83)2&gt; end</font></span></span><span lang="EN-US" style="font-family: consolas"><font color="#000000"><font size="3"><o:p></o:p></font></font></span></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font color="#000000"><font size="3"><span style="font-family: 宋体">正常完成了</span><span lang="EN-US" style="font-family: consolas">terminate<o:p></o:p></span></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><b><span lang="EN-US" style="font-family: consolas; color: black"><span><font size="3">4．</font><span style="font: 7pt 'times new roman'"> </span></span></span></b><b><span lang="EN-US" style="font-family: consolas; color: black"><font size="3">init:stop + one_for_one<o:p></o:p></font></span></b></p>
<blockquote>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">(test@192.168.1.83)2&gt; init:stop().</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">ok</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">(test@192.168.1.83)3&gt; i&#39;m terminate:shutdown</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">end[root@ming2_local_dev test]#</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
</blockquote>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span lang="EN-US" style="font-family: consolas; color: black">ok</span><span style="font-family: 宋体; color: black">，很完整的执行了我们的</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">。</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">执行测试结果</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p>&nbsp;</p>
<table border="1" cellpadding="0" cellspacing="0" class="MsoTableGrid" style="border-bottom: medium none; border-left: medium none; border-collapse: collapse; border-top: medium none; border-right: medium none">
	<tbody>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><font size="3">Simple_one_for_one<o:p></o:p></font></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><font size="3">One_for_one<o:p></o:p></font></span></p>
			</td>
		</tr>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">进程主动退出</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">完整执行</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">完整执行</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
		</tr>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><font size="3">init:stop<o:p></o:p></font></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">不能完整执行</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">完整执行</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
		</tr>
	</tbody>
</table>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -22.5pt; margin: 0cm 0cm 0pt 22.5pt"><font size="3"><b><span lang="EN-US" style="font-family: consolas; color: black"><span>三、</span></span></b><b><span style="font-family: 宋体; color: black">底层分析</span></b><b><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></b></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><font color="#000000"><font size="3"><span style="font-family: 宋体">看起来很奇怪的结果，还是从源码来分析问题。从</span><span lang="EN-US">supervisor</span><span style="font-family: 宋体">开始：</span></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span lang="EN-US"><o:p><font color="#000000" size="3">&nbsp;</font></o:p></span></p>
<blockquote>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><em><font color="#4f81bd"><font size="3"><span class="MsoIntenseEmphasis"><span lang="EN-US"><o:p></o:p></span></span></font></font></em></strong></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span class="MsoIntenseEmphasis"><span lang="EN-US"><o:p><strong><em><font color="#4f81bd" size="3">&nbsp;</font></em></strong></o:p></span></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">terminate</span><span lang="EN-US" style="font-family: consolas; color: black">(_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; terminate_children(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state.children</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state.name</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp; ok.</span></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
	<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">terminate_children/2 </span><span style="font-family: 宋体">是一个尾递归函数，依次结束每个子进程</span><span lang="EN-US">:</span></font></span></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">terminate_children</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Children</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; terminate_children(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Children</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">, []).<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">terminate_children</span><span lang="EN-US" style="font-family: consolas; color: black">([</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black"> | </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Children</span><span lang="EN-US" style="font-family: consolas; color: black">], </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Res</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NChild</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> do_terminate(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp; terminate_children(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Children</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">, [</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NChild</span><span lang="EN-US" style="font-family: consolas; color: black"> | </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Res</span><span lang="EN-US" style="font-family: consolas; color: black">]);<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">terminate_children</span><span lang="EN-US" style="font-family: consolas; color: black">([], _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Res</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Res</span><span lang="EN-US" style="font-family: consolas; color: black">.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;<span _fck_bookmark="1" style="display: none">&nbsp;</span></font></o:p></span></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">在看</span><span lang="EN-US" style="font-family: consolas; color: black">do_terminate/2<o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">do_terminate</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">when</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child.pid</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=/=</span><span lang="EN-US" style="font-family: consolas; color: black"> undefined </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> shutdown(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child.pid</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child.shutdown</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; ok </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child</span><span lang="EN-US" style="font-family: consolas; color: black">{pid </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> undefined};<br />
		&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; report_error(shutdown_error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child</span><span lang="EN-US" style="font-family: consolas; color: black">{pid </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> undefined}<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">do_terminate</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupName</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font size="3"><span style="font-family: 宋体; color: black">继续：</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">shutdown</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, brutal_kill) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp; <br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> monitor_child(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; ok </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">exit</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, kill),<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, killed} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ok;<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;<br />
		&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">shutdown</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Time</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; <br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> monitor_child(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; ok </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">exit</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, shutdown), </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Try to shutdown gracefully</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, shutdown} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ok;<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">after</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Time</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">exit</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, kill),&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Force termination.</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;<br />
		&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><font size="3"><span lang="EN-US" style="font-family: consolas; color: black">Ok</span><span style="font-family: 宋体; color: black">，结束子进程时分情况处理了，先看看</span><span lang="EN-US" style="font-family: consolas; color: black">monitor_child/1</span><span style="font-family: 宋体; color: black">，代码注释的比较详细，简单的说是用于处理</span><span lang="EN-US" style="font-family: consolas; color: black">child</span><span style="font-family: 宋体; color: black">自己退出的情况。</span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">monitor_child</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; <br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Do the monitor operation first so that if the child dies </span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% before the monitoring is done causing a &#39;DOWN&#39;-message with</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% reason noproc, we will get the real reason in the &#39;EXIT&#39;-message</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% unless a naughty child has already done unlink...</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: blue">erlang</span></b><span lang="EN-US" style="font-family: consolas; color: black">:</span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">monitor</span><span lang="EN-US" style="font-family: consolas; color: black">(process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">unlink</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% If the child dies before the unlik we must empty</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% the mail-box of the &#39;EXIT&#39;-message and the &#39;DOWN&#39;-message.</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {&#39;EXIT&#39;, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, _} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Reason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">after</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">0</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% If a naughty child did unlink and the child dies before</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% monitor the result will be that shutdown/2 receives a </span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% &#39;DOWN&#39;-message with reason noproc.</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% If the child should die after the unlink there</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% will be a &#39;DOWN&#39;-message with a correct reason</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% that will be handled in shutdown/2. </span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ok&nbsp;&nbsp; <br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span lang="EN-US" style="font-family: consolas; color: black"><o:p><font size="3">&nbsp;</font></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">回头看</span><span lang="EN-US" style="font-family: consolas; color: black">shutdown/2</span><span style="font-family: 宋体; color: black">，主要区别在于</span><span lang="EN-US" style="font-family: consolas; color: black">exit(Pid, Reason)</span><span style="font-family: 宋体; color: black">这一行，如果子进程的</span><span lang="EN-US" style="font-family: consolas; color: black">shutdown</span><span style="font-family: 宋体; color: black">策略为</span><span lang="EN-US" style="font-family: consolas; color: black">brutal_kill</span><span style="font-family: 宋体; color: black">，则子进程被直接</span><span lang="EN-US" style="font-family: consolas; color: black">kill</span><span style="font-family: 宋体; color: black">，而</span><span lang="EN-US" style="font-family: consolas; color: black">kill</span><span style="font-family: 宋体; color: black">消息是不能被捕捉的，也就不存在</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">被调用的可能了（</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">能被调用是因为捕捉了</span><span lang="EN-US" style="font-family: consolas; color: black">{&lsquo;EXIT&rsquo;,_, _}</span><span style="font-family: 宋体; color: black">消息，详细情况请自行查看</span><span lang="EN-US" style="font-family: consolas; color: black">gen_server</span><span style="font-family: 宋体; color: black">实现）。如果你想在退出时清理数据，这里一定不能设置为</span><span lang="EN-US" style="font-family: consolas; color: black">brutal_kill</span><span style="font-family: 宋体; color: black">，而是设置为一个较大的时间数值（毫秒），用于等待子进程做善后工作：</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">exit</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, shutdown), </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Try to shutdown gracefully</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, shutdown} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ok;<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">after</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Time</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">exit</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, kill),&nbsp; </span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%% Force termination.</span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">receive</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&#39;DOWN&#39;, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MRef</span><span lang="EN-US" style="font-family: consolas; color: black">, process, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">OtherReason</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		</span><span style="font-family: 宋体; color: black">如果在指定时间内，子进程尚未结束，则强制</span><span lang="EN-US" style="font-family: consolas; color: black">kill</span><span style="font-family: 宋体; color: black">。</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">从这一块的源码中我们没有看到</span><span lang="EN-US" style="font-family: consolas; color: black">restart strategy(one_for_one &hellip;)</span><span style="font-family: 宋体; color: black">对</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">的影响，这跟上面的测试结果不太吻合。过一遍</span><span lang="EN-US" style="font-family: consolas; color: black">supervisor</span><span style="font-family: 宋体; color: black">的代码，发现针对</span><span lang="EN-US" style="font-family: consolas; color: black">simple_one_for_one</span><span style="font-family: 宋体; color: black">和</span><span lang="EN-US" style="font-family: consolas; color: black">one_for_one</span><span style="font-family: 宋体; color: black">的子进程的启动过程是不同的：</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<blockquote>
	<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_call</span><span lang="EN-US" style="font-family: consolas; color: black">({start_child, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">EArgs</span><span lang="EN-US" style="font-family: consolas; color: black">}, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">From</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">when</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?is_simple</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#child</span><span lang="EN-US" style="font-family: consolas; color: black">{mfa </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">M</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">F</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">A</span><span lang="EN-US" style="font-family: consolas; color: black">}} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">hd</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state.children</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Args</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">A</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">++</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">EArgs</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> do_start_child_i(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">M</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">F</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Args</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state</span><span lang="EN-US" style="font-family: consolas; color: black">{dynamics </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?DICT</span><span lang="EN-US" style="font-family: consolas; color: black">:store(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Args</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state.dynamics</span><span lang="EN-US" style="font-family: consolas; color: black">)},<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {reply, {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Extra</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state</span><span lang="EN-US" style="font-family: consolas; color: black">{dynamics </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?DICT</span><span lang="EN-US" style="font-family: consolas; color: black">:store(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Args</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: rgb(160,160,0)">#state.dynamics</span><span lang="EN-US" style="font-family: consolas; color: black">)},<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {reply, {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Pid</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Extra</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">What</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {reply, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">What</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;<br />
		<br />
		</span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%%% The requests terminate_child, delete_child and restart_child are </span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		</span><i><span lang="EN-US" style="font-family: consolas; color: rgb(0,136,0)">%%% invalid for simple_one_for_one supervisors. </span></i><span lang="EN-US" style="font-family: consolas; color: black"><br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_call</span><span lang="EN-US" style="font-family: consolas; color: black">({_</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Req</span><span lang="EN-US" style="font-family: consolas; color: black">, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Data</span><span lang="EN-US" style="font-family: consolas; color: black">}, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">From</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">when</span></b><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(136,0,0)">?is_simple</span><span lang="EN-US" style="font-family: consolas; color: black">(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {reply, {error, simple_one_for_one}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		<br />
		</span><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)">handle_call</span><span lang="EN-US" style="font-family: consolas; color: black">({start_child, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">ChildSpec</span><span lang="EN-US" style="font-family: consolas; color: black">}, _</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">From</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">case</span></b><span lang="EN-US" style="font-family: consolas; color: black"> check_childspec(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">ChildSpec</span><span lang="EN-US" style="font-family: consolas; color: black">) </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">of</span></b><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp; {ok, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Resp</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black">} </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> handle_start_child(</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Child</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">),<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {reply, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">Resp</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">NState</span><span lang="EN-US" style="font-family: consolas; color: black">};<br />
		&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">What</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {reply, {error, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">What</span><span lang="EN-US" style="font-family: consolas; color: black">}, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">State</span><span lang="EN-US" style="font-family: consolas; color: black">}<br />
		&nbsp;&nbsp;&nbsp; </span><b><span lang="EN-US" style="font-family: consolas; color: rgb(170,34,255)">end</span></b><span lang="EN-US" style="font-family: consolas; color: black">;</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
</blockquote>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">simple_one_for_one</span><span style="font-family: 宋体; color: black">形式启动的子进程根本没有放在</span><span lang="EN-US" style="font-family: consolas; color: black">supervisor</span><span style="font-family: 宋体; color: black">的</span><span lang="EN-US" style="font-family: consolas; color: black">state.children</span><span style="font-family: 宋体; color: black">里面，也就是说</span><span lang="EN-US" style="font-family: consolas; color: black">supervisor</span><span style="font-family: 宋体; color: black">在</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">的时候根本没管</span><span lang="EN-US" style="font-family: consolas; color: black">simple_one_for_one</span><span style="font-family: 宋体; color: black">形式启动的子进程，如此当</span><span lang="EN-US" style="font-family: consolas; color: black">supervisor</span><span style="font-family: 宋体; color: black">结束时，所有的</span><span lang="EN-US" style="font-family: consolas; color: black">simple_one_for_one</span><span style="font-family: 宋体; color: black">子进程都会收到一条</span><span lang="EN-US" style="font-family: consolas; color: black">{&lsquo;EXIT&rsquo;, Pid, Reason}</span><span style="font-family: 宋体; color: black">的消息，如果子进程有处理这样的消息并返回了</span><span lang="EN-US" style="font-family: consolas; color: black">stop</span><span style="font-family: 宋体; color: black">，则会调用</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">。</span><span style="font-family: consolas; color: black"> </span><span style="font-family: 宋体; color: black">但在执行</span><span lang="EN-US" style="font-family: consolas; color: black">terminate</span><span style="font-family: 宋体; color: black">期间，</span><span lang="EN-US" style="font-family: consolas; color: black">app</span><span style="font-family: 宋体; color: black">可能已经结束，从而正在停止中的系统会直接</span><span lang="EN-US" style="font-family: consolas; color: black">kill</span><span style="font-family: 宋体; color: black">掉该进程（实际上是所有剩余的进程），使得其没有时间执行完所有的功能代码（参考之前的分析《</span><span lang="EN-US" style="font-family: consolas; color: black">init:stop</span><span style="font-family: 宋体; color: black">浅析》）。</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
<p align="left" class="MsoListParagraph" style="text-align: left; text-indent: -22.5pt; margin: 0cm 0cm 0pt 22.5pt"><span style="font-size: 12px"><b><span lang="EN-US" style="font-family: consolas; color: black">四、</span><span style="font-family: 宋体; color: black">结论、问题与解决办法</span></b></span><font size="3"><b><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></b></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">1．<span style="line-height: normal; font-variant: normal; font-style: normal; font-family: 'times new roman'; font-weight: normal">&nbsp; </span></span><span style="font-family: 宋体">结论</span></font></span></p>
<p><span style="font-size: 12px">&nbsp;</span></p>
<table border="1" cellpadding="0" cellspacing="0" class="MsoTableGrid" style="border-bottom: medium none; border-left: medium none; border-collapse: collapse; border-top: medium none; border-right: medium none">
	<tbody>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black"><o:p>&nbsp;</o:p></span></span><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">Simple_one_for_one</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: black 1pt solid; border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">One_for_one</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
			</td>
		</tr>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">进程主动退出</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">完整执行</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">完整执行</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
		</tr>
		<tr>
			<td style="border-bottom: black 1pt solid; border-left: black 1pt solid; padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: black">init:stop</span></span><span lang="EN-US" style="font-family: consolas; color: black"><font size="3"><o:p></o:p></font></span></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">不能完整执行</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
			<td style="border-bottom: black 1pt solid; border-left: rgb(0,0,0); padding-bottom: 0cm; background-color: transparent; padding-left: 5.4pt; width: 142.05pt; padding-right: 5.4pt; border-top: rgb(0,0,0); border-right: black 1pt solid; padding-top: 0cm" valign="top" width="189">
				<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span style="font-family: 宋体; color: black">完整执行</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
			</td>
		</tr>
	</tbody>
</table>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">2．<span style="line-height: normal; font-variant: normal; font-style: normal; font-family: 'times new roman'; font-weight: normal">&nbsp; </span></span><span style="font-family: 宋体">问题</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span style="font-family: 宋体">使用</span><span lang="EN-US">simple_one_for_one</span><span style="font-family: 宋体">时，在系统关闭时，可能无法正常的完成某些的善后工作，如数据持久等等</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent: -18pt; margin: 0cm 0cm 0pt 18pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">3．<span style="line-height: normal; font-variant: normal; font-style: normal; font-family: 'times new roman'; font-weight: normal">&nbsp; </span></span><span style="font-family: 宋体">解决办法</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span style="font-family: 宋体">使用</span><span lang="EN-US">one_for_one</span><span style="font-family: 宋体">，但是</span><span lang="EN-US">one_for_one</span><span style="font-family: 宋体">的启动过程需要做一些简单的调整：</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">sup</span><span style="font-family: 宋体">树的</span><span lang="EN-US">init</span><span style="font-family: 宋体">返回：</span></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US" style="font-family: consolas; color: rgb(0,160,0)"><span _fck_bookmark="1" style="display: none">&nbsp;</span><span _fck_bookmark="1" style="display: none">&nbsp;</span>init</span><span lang="EN-US" style="font-family: consolas; color: black">([]) </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">-&gt;</span><span lang="EN-US" style="font-family: consolas; color: black"><br />
	&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">RestartStrategy</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> one_for_one,<br />
	&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxRestarts</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">1000</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
	&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxSecondsBetweenRestarts</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">3600</span><span lang="EN-US" style="font-family: consolas; color: black">,<br />
	&nbsp;&nbsp;&nbsp; </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupFlags</span><span lang="EN-US" style="font-family: consolas; color: black"> </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">=</span><span lang="EN-US" style="font-family: consolas; color: black"> {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">RestartStrategy</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxRestarts</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MaxSecondsBetweenRestarts</span><span lang="EN-US" style="font-family: consolas; color: black">},<br />
	&nbsp;&nbsp;&nbsp; {ok, {</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">SupFlags</span><span lang="EN-US" style="font-family: consolas; color: black">, []}}.</span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><o:p></o:p></span></font></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><span lang="EN-US"><o:p><font color="#000000">&nbsp;</font></o:p></span></span><span lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 12px"><font color="#000000"><span lang="EN-US">start_child</span><span style="font-family: 宋体">的时候</span><span lang="EN-US">childspec</span><span style="font-family: 宋体">需要拼凑</span><span lang="EN-US">spec id</span><span style="font-family: 宋体">：</span></font></span></p>
<p align="left" class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt"><span style="font-size: 12px"><b><span lang="EN-US" style="font-family: consolas; color: blue">supervisor</span></b><span lang="EN-US" style="font-family: consolas; color: black">:start_child(mod_stall_sup, <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><b><span lang="EN-US" style="font-family: consolas; color: blue">lists</span></b><span lang="EN-US" style="font-family: consolas; color: black">:concat([</span><span lang="EN-US" style="font-family: consolas; color: rgb(187,68,68)">&quot;mod_stall_server_&quot;</span><span lang="EN-US" style="font-family: consolas; color: black">, </span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MAPID</span><span lang="EN-US" style="font-family: consolas; color: black">]), <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mod_stall_server, start_link, [</span><span lang="EN-US" style="font-family: consolas; color: darkgoldenrod">MAPID</span><span lang="EN-US" style="font-family: consolas; color: black">]},<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transient, </span><span lang="EN-US" style="font-family: consolas; color: rgb(102,102,102)">30000</span><span lang="EN-US" style="font-family: consolas; color: black">, worker, [mod_stall_server]})<span _fck_bookmark="1" style="display: none">&nbsp;</span><span _fck_bookmark="1" style="display: none">&nbsp;</span></span></span><font size="3"><span lang="EN-US" style="font-family: consolas; color: black"><span _fck_bookmark="1" style="display: none">&nbsp;</span></span></font></p>
